<!doctype html>
<html class="no-js" lang="fr" dir="ltr" itemscope itemtype="http://schema.org/Article" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml">
<head id="phollow-fr" data-template-set="html5-phollow-wordpress-theme" profile="http://purl.org/uF/hAtom/0.1/ http://purl.org/uF/2008/03/" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# phollow: http://ogp.me/ns/fb/phollow#">
  <meta charset="UTF-8">
  <title>Renforcer la sécurité de son serveur SSH</title>
  <link href="https://plus.google.com/116513653525162928064" rel="publisher">
  <meta name="title" content="Renforcer la sécurité de son serveur SSH">
  <meta name="author" content="Jérôme Mahuet">
  <meta name="Copyright" content="Copyright Jérôme Mahuet 2012. All Rights Reserved.">
  <meta name="google-site-verification" content="b3k5NRe5t9U-Pk1_CK_g5oN0U12YXuc55rUQWCHgbZY">
  <meta property="og:title" content="Renforcer la sécurité de son serveur SSH">
  <meta property="og:type" content="phollow:post">
  <meta property="og:site_name" content="Phollow.me">
  <meta property="fb:admins" content="rydgel">
  <meta property="fb:app_id" content="101739241646">
  <meta itemprop="name" content="Renforcer la sécurité de son serveur SSH">
  <meta http-equiv="cleartype" content="on">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml">
  <script src="/js/compiled/modernizr.min.js"></script>
  <script>
    (function() {
    WebFontConfig = {
      fontdeck: {
        id: '19429'
      }
    };
    var h=document.getElementsByTagName("html")[0];
    h.className+=" wf-loading";
    var t=setTimeout(function(){h.className=h.className.replace(/( |^)wf-loading( |$)/g,"");h.className+=" wf-inactive"}, 3000);
    var tk=document.createElement("script");
    tk.src='//ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    tk.type="text/javascript";
    tk.async="true";
    tk.onload=tk.onreadystatechange=function(){
      var a=this.readyState;
      if(a&&a!="complete"&&a!="loaded")return;clearTimeout(t);};
    var s=document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(tk,s)
    })();
  </script>
  
  <link rel="stylesheet" href="/css/compiled/global.css?v=20">
</head>
<body>
  <div class="container" role="wrapper">
    <header role="banner" id="header-site" class="sixteen columns">
      <h1 id="logo" class="four columns alpha">
        <a href="/" title="Phollow.me">
          <img src="/images/phollow-logo.png" alt="Phollow.me">
        </a>
      </h1>
      <nav role="main-navigation" class="seven columns">
        <ul>
          <li>
            <a href="/" title="blog">
            <span class="ss-icon ss-write"></span>
            <span>Articles</span>
            </a>
          </li>
          <li>
            <a href="http://jrm.li/projects" title="Projets">
            <span class="ss-icon ss-notebook"></span>
            <span>Projets</span>
            </a>
          </li>
          <li>
            <a href="http://jrm.li/" title="À propos">
            <span class="ss-icon ss-user"></span>
            <span>À propos</span>
            </a>
          </li>
          <li>
            <a href="http://feeds2.feedburner.com/phollow/iuEO" title="RSS">
            <span class="ss-icon ss-rss"></span>
            <span>Flux Rss</span>
            </a>
          </li>
        </ul>
      </nav>
      <hr style="border-bottom: 1px solid rgba(0, 0, 0, 0.02);">
    </header>

<div id="container" class="sixteen columns">
  <article class="post">
      <header>
    <h2 class="entry-title entry-single"><a href="/2010/02/renforcer-la-securite-de-son-serveur-ssh">Renforcer la sécurité de son serveur SSH</a></h2>
      </header>
      <div class="entry single-page ten columns offset-by-three alpha">
        <p style="text-align: justify;">Le protocole SSH est utilisé pour transmettre des informations de manière sécurisé entre deux terminaux. Par exemple comme se loguer sur une machine distante, ou échanger des fichiers, le tout crypté. Il est de par sa conception très sécurisé, mais une mauvaise configuration peut tout gâcher.</p>
<p style="text-align: justify;"><a href="http://static.phollow.fr/2010/01/openssh.jpg"><img class="aligncenter size-full wp-image-2100" title="openssh" src="http://static.phollow.fr/2010/01/openssh.jpg" alt="" width="400" height="200" /></a></p>

<h3>Fichiers de configuration par défaut</h3>
<p style="text-align: justify;"></p>

<ul>
	<li><strong>/etc/ssh/sshd_config </strong>- Fichier de configuration du serveur SSH.</li>
	<li><strong>/etc/ssh/ssh_config</strong> - Fichier de configuration du client SSH</li>
	<li><strong>~/.ssh/</strong> - Répertoire de configuration SSH d'un utilisateur.</li>
	<li><strong>/etc/nologin</strong> - Si ce fichier existe, personne ne peut se connecter à part root.</li>
	<li><strong>/etc/hosts.allow</strong> et <strong>/etc/hosts.deny</strong> : Blacklist et whitelist .</li>
	<li><strong>SSH port par défaut </strong>: TCP 22</li>
</ul>
<h3>Utiliser le protocole SSH 2</h3>
<p style="text-align: justify;">Le protocole 1 est obsolète et vulnérable à de nombreuses attaques (comme man-in-the-middle). Il doit être évité à tout pris. Vérifiez dans le sshd_config que la ligne suivante existe :</p>

<pre lang="bash">Protocol 2</pre>
<h3>Choisir les utilisateurs</h3>
<p style="text-align: justify;">Par défaut n'importe quel utilisateur à le droit de se connecter en SSH. Par exemple un utilisateur ftp à la possibilité de se connecter. Ce n'est pas super pertinent. Alors on peut restreindre le serveur SSH à n'autoriser que certains compte utilisateur. Pour ça on peut utiliser (toujours dans le sshd_config)  :</p>

<pre lang="bash">AllowUsers root rydgel</pre>
<p style="text-align: justify;">Qui autorise ces 2 utilisateurs à pouvoir se connecter. Inversement la commande <strong>DenyUsers</strong>, permet de refuser la connexion.</p>

<h3 style="text-align: justify;">Désactiver les fichiers .rhosts</h3>
<p style="text-align: justify;"></p>
<p style="text-align: justify;">Ces fichiers permettent de se connecter automatiquement au serveur sans avoir besoin de retaper le mot de passe. Sympa pour les feignants mais pas sécurisé du tout. Donc il vaut mieux désactiver l'utilisation de ces fichiers avant que quelqu'un ne tombe dessus ;)</p>

<pre lang="bash">IgnoreRhosts yes</pre>
<h3>Ajouter un timeout sur l'inactivité</h3>
<p style="text-align: justify;">Garder la session ouverte indéfiniment n'est pas non plus une bonne idée. Vous êtes au boulot, vous vous absentez une heure ou deux et vous oubliez de fermer votre session, n'importe qui peut attraper votre shell en root et faire ce qu'il veut pendant votre absence.</p>

<pre lang="bash">ClientAliveInterval 360
ClientAliveCountMax 0</pre>
<h3>Désactiver le login de root</h3>
<p style="text-align: justify;">Une autre manière de sécuriser est de désactiver le login de root et d'utiliser un user avec des droits moindres + sudo.</p>

<pre lang="bash">PermitRootLogin no</pre>
<h3>Changer le port par défaut d'openSSH</h3>
<p style="text-align: justify;">Le port 22 est connu par tous les pirates pour être celui d'openSSH. Les robots scannent en priorité ce port, pour le changer c'est tout simple :</p>

<pre lang="bash">Port 6345</pre>
<h3>N'autoriser que certaines IP à se connecter</h3>
<p style="text-align: justify;">Par exemple si je veux que seulement ces 2 adresses IP ait le droit de se connecter sur mon serveur (192.168.1.5 et 202.54.1.5). Il y a deux solutions. La première est d'utiliser les fichiers /etc/hosts.allow et /etc/hosts.deny. On commence par bloquer toutes les IPs dans le hosts.deny, puis on autorise seulement celles que l'on veut.</p>

<pre lang="bash">dans /etc/hosts.deny :
sshd: ALL
On bloque par défaut toutes les IPs, puis dans le /etc/hosts.allow :
sshd: 192.168.1.5
sshd: 202.54.1.5</pre>
<p style="text-align: justify;">La deuxième solution (et la meilleure à mon avis) est d'utiliser le firewall du système (iptables, pf) et d'autoriser seulement les IPs que l'on veut sur le port d'OpenSSH.</p>

<h3>Utiliser un bon mot de passe</h3>
<p style="text-align: justify;">On voit encore trop souvent des mots de passe du style '12345' ou 'admin'. Le plus simple est de se créer un mot passe aléatoirement avec des chiffres, des lettres (majuscules et minuscules) et des caractères spéciaux. <a href="http://www.goodpassword.com/" target="_blank">http://www.goodpassword.com/</a> est un site qui permet de le faire pour vous :)</p>

<h3>Personne ne doit avoir un mot de passe vide</h3>
<p style="text-align: justify;">Vérifiez que les utilisateurs de votre machine n'ont pas de mot de passe vide. On peut aussi dire à OpenSSH de ne pas accepter les connexions d'utilisateurs sans mot de passe.</p>

<pre lang="bash">PermitEmptyPasswords no</pre>
<h3>Garder OpenSSH et votre système à jour</h3>
<p style="text-align: justify;">On ne le dira jamais assez mais les mises-à-jour sont vraiment importantes. Elles corrigent la plupart du temps des failles qui peuvent être utilisées par des pirates pour compromettre votre système. Personnellement je regarde si des mises à jours de sécurité sont disponibles tous les jours.</p>

<h3>Désactiver OpenSSH si vous ne l'utilisez pas</h3>
<p style="text-align: justify;">Ça ne sert à rien de laisser des services ouverts sur l'ordinateur si vous ne vous en servez pas. Désinstallez le serveur openSSH s'il n'est pas utilisé. Ça fera toujours une porte de moins pour accéder à votre machine.</p>

<h3>Conclusion</h3>
<p style="text-align: justify;">Il y a encore des dizaines de manips possibles pour augmenter encore plus la sécurité, comme le chrootage des utilisateurs, la configuration d'un firewall, l'installation de fail2ban contre les attaques brute-force etc. Mais je pense que ce petit article est un bon début, pour éviter de faire des bêtises sur son serveur.</p>
      </div>
      <cite class="omega three columns entry-meta">
        <p>
          <time datetime="2010-02-04 14:28:57 +0100" pubdate class="updated ss-globe">February  4, 2010</time>
          <br>
          <span class="ss-tag"><a href="/category/linux" rel="category tag">linux</a>, <a href="/category/tutoriel" rel="category tag">tutoriel</a></span>
        </p>
        </cite>
      <footer class="share alpha twelve columns offset-by-three">
      <a id="tweet" href="http://twitter.com/?status=Renforcer%20la%20s%C3%A9curit%C3%A9%20de%20son%20serveur%20SSH%20http%3A%2F%2Fphollow.fr/2010/02/renforcer-la-securite-de-son-serveur-ssh%20via%20%40phollow" class="ss-icon ss-social ss-twitter twitter-button">&nbsp;<span>Partager</span></a>
      </footer>
    </article>
      <hr>
      <div id="disqus_thread"></div>
      <script>
          var disqus_shortname = 'phollowfr';
          var disqus_identifier = 'http://phollow.fr/2010/02/renforcer-la-securite-de-son-serveur-ssh/';
          var disqus_url = 'http://phollow.fr/2010/02/renforcer-la-securite-de-son-serveur-ssh/';

          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
</div>


<footer id="footer" role="contentinfo" class="sixteen columns">
  <nav role="navigation">
    <ul>
      <li><a href="/">Homepage</a></li>
      <li><a href="http://twitter.com/phollow">Twitter</a></li>
      <li><a href="https://www.facebook.com/Phollow.fr">Facebook</a></li>
      <li><a href="http://dribbble.com/phollow">Dribbble</a></li>
      <li><a href="mailto:rydgel@phollow.fr">Contact</a></li>
    </ul>
  </nav>
  <span class="copyright">Copyright © 2012 <a rel="author"
      href="https://plus.google.com/113221045987282389062?rel=author"
      title="Jérôme Mahuet">+Jérôme Mahuet</a> All Rights Reserved.
    Hosted by <a href="http://www.heroku.com/">Heroku.</a></span>
<a title="Phollow.me" class="footer-logo-link" href="http://phollow.fr"><img src="/images/phollow-logo-footer.png" alt="Phollow.me"></a>
</footer>

</div><!-- container -->
<script src="/js/compiled/global.js?v=6"></script>

<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4ec64821f5a1f55c33000003');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
</body>
</html>

