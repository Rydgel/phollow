<!doctype html> <html class="no-js" lang="en-US" dir="ltr" itemscope itemtype="http://schema.org/Article" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml"> <head profile="http://purl.org/uF/hAtom/0.1/ http://purl.org/uF/2008/03/" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# phollow: http://ogp.me/ns/fb/phollow#"> <meta charset="UTF-8"> <title>Un exemple d'utilisation de chroot : réinstaller GRUB</title> <link href="https://plus.google.com/116513653525162928064" rel="publisher"> <meta name="title" content="Un exemple d'utilisation de chroot : réinstaller GRUB"> <meta name="author" content="Jérôme Mahuet"> <meta name="Copyright" content="Copyright Jérôme Mahuet 2013. All Rights Reserved."> <meta name="google-site-verification" content="b3k5NRe5t9U-Pk1_CK_g5oN0U12YXuc55rUQWCHgbZY"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@phollow"> <meta name="twitter:creator" content="@phollow"> <meta property="og:url" value="http://phollow.fr/2008/11/un-exemple-dutilisation-de-chroot-reinstaller-grub/"> <meta property="og:description" value="GRUB est une application permettant de choisir sous quel OS booter. Elle s'installe sur la MBR du disque dur. Il arrive parfois qu'elle ne fonctionne plus ( souvent suite à une réinstallation de Windows ) et ainsi il n'est plus possible ..."> <meta property="og:image" value="http://phollow.fr/images/phollow-logo3.png"> <meta property="og:type" content="phollow:post"> <meta property="og:site_name" content="Phollow.me"> <meta property="fb:admins" content="rydgel"> <meta property="fb:app_id" content="101739241646"> <meta itemprop="name" content="Un exemple d'utilisation de chroot : réinstaller GRUB"> <meta property="og:title" value="Un exemple d'utilisation de chroot : réinstaller GRUB"> <meta http-equiv="cleartype" content="on"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml"> <link rel="stylesheet" href="/css/screen.css?v=110"> <!--[if lt IE 9]><script src="/js/compiled/modernizr.min.js"></script><![endif]--> </head> <body> <header role="post"> <div class="container"> <h1 id="logo"> <a href="/" title="Phollow.me"> <img src="/images/phollow-logo3.png" alt="Phollow.me"> </a> </h1> </div> </header> <section role="articles"> <div class="container"> <article class="post"> <time datetime="2008-11-10 00:06:30 +0100">Nov 10, 2008</time> <h2 class="entry-title"> <a title="Un exemple d'utilisation de chroot : réinstaller GRUB" href="/2008/11/un-exemple-dutilisation-de-chroot-reinstaller-grub/">Un exemple d'utilisation de chroot : réinstaller GRUB</a> </h2> <section role="post-content"> <p>GRUB est une application permettant de choisir sous quel OS booter. Elle s'installe sur la MBR du disque dur. Il arrive parfois qu'elle ne fonctionne plus ( souvent suite à une réinstallation de Windows ) et ainsi il n'est plus possible de démarrer l'ordinateur. L'utilisation de la commande chroot avec un LiveCD est une manière possible de réparer GRUB.</p> <h3 style="text-align: left;">Introduction</h3> <p style="text-align: justify;" lang="PHP">Dans un système UNIX, la racine des répertoires ( root en anglais ) est noté "/" . La commande chroot permet de faire croire à un processus que la racine "/" est ailleurs ! Vous pouvez donc par exemple avoir un système d'exploitation complet dans /mnt/ubuntu . En utilisant la commande :</p> <code>chroot /mnt/ubuntu bash -i</code> Vous lancez un shell Bash depuis le système de fichier "/mnt/ubuntu" pour qui "/mnt/ubuntu" est en fait la racine du système. "/mnt/ubuntu" est devenue une nouvelle "/" indépendante de la racine initiale. Toute commande effectuée à l'intérieur de ce bash n'aura aucune connaissance du vrai répertoire racine. Tout ce passe comme si vous étiez sur une autre machine UNIX. <h3>Et GRUB alors ?</h3> L'astuce est la suivante : nous allons booter sur notre LiveCD et chrooter sur notre linux installé. Pour ensuite réinstaller le GRUB facilement <h3>C'est parti !</h3> Alors tout d'abord il vous faut un LiveCD, n'importe lequel devrait suffire, <a href="http://knoppix-fr.org/">Knoppix</a> par exemple. Insérez le dans votre ordinateur et redémarrez. Une fois le démarrage terminé, ouvrez une console. Passez en mode superutilisateur (root) en tapant la commande suivante sur Knoppix: <code>su -</code> Maintenant il faut créer notre espace de travail et monter les partitions de notre installation Linux. Il faut créer un répertoire pour notre point de montage : <code>mkdir /mnt/help</code> Si votre "/boot" est dans une partition differente de la racine du système il faut aussi créer le dossier boot : <code>mkdir /mnt/help/boot</code> Il est maintenant temps de chargé les données dans ces dossiers. Dans mon système la partition /dev/hda4 correspond à la racine de mon système. Adapter donc la commande suivante pour vous : <code>mount /dev/hda4 /mnt/help mount -o bind /dev /mnt/help/dev mount -o bind /proc /mnt/help/proc cp /proc/mounts /mnt/help/etc/mtab</code> Et si votre "/boot" est sur une autre partition monter la aussi comme ceci : <code>mount /dev/hda5 /mnt/help/boot</code> Maintenant il suffit de rentrer dans l'environnement de travail avec chroot : <code>chroot /mnt/help/ /bin/bash</code> À partir de maintenant vous n'êtes plus dans le LiveCD mais sur le système Linux que vous avez installé. Donc toute modification est prise en compte ! <h3>Réparons GRUB</h3> Lancez la commande "grub" : un prompt devrait apparaître. Lancer ensuite : <code>grub> find /boot/grub/stage1 # Vous obtenez la réponse sous la forme hdx,y # avec x et y deux nombres grub> root (hdx,y) # Avec les nombres que vous avez eu au dessus grub> setup (hd0) # On réecrit la MBR grub> quit # On quitte</code> Et voila normalement c'est réparé, vous pouvez quitter le LiveCD et essayer de rebooter sur votre système. </section> <section role="share"> <a href="https://twitter.com/share" class="twitter-share-button" data-via="phollow">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> </section> </article> </div> </section> <footer> <div class="container"> <p><a href="http://jrm.li" target="_blank">Jérôme Mahuet</a> - Hosted by <a href="http://heroku.com">Heroku</a> &amp; <a href="https://github.com/Rydgel/phollow">open-source</a>.</p> </div> </footer> </body> </html>