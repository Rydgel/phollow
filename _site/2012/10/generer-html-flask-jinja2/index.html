<!doctype html> <html class="no-js" lang="en-US" dir="ltr" itemscope itemtype="http://schema.org/Article" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml"> <head profile="http://purl.org/uF/hAtom/0.1/ http://purl.org/uF/2008/03/" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# phollow: http://ogp.me/ns/fb/phollow#"> <meta charset="UTF-8"> <title>Générer son HTML sous Flask avec Jinja2</title> <link href="https://plus.google.com/116513653525162928064" rel="publisher"> <meta name="title" content="Générer son HTML sous Flask avec Jinja2"> <meta name="author" content="Jérôme Mahuet"> <meta name="Copyright" content="Copyright Jérôme Mahuet 2013. All Rights Reserved."> <meta name="google-site-verification" content="b3k5NRe5t9U-Pk1_CK_g5oN0U12YXuc55rUQWCHgbZY"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@phollow"> <meta name="twitter:creator" content="@phollow"> <meta property="og:url" value="http://phollow.fr/2012/10/generer-html-flask-jinja2/"> <meta property="og:description" value="Suite du [précédent article](http://phollow.fr/2012/08/demarrer-la-creation-site-python-flask/) sur le développement web avec Python & Flask, nous allons voir comment afficher nos différentes pages. Assembler du HTML tend à être fait ave..."> <meta property="og:image" value="http://static.phollow.fr/2012/08/flask.png"> <meta property="og:type" content="phollow:post"> <meta property="og:site_name" content="Phollow.me"> <meta property="fb:admins" content="rydgel"> <meta property="fb:app_id" content="101739241646"> <meta itemprop="name" content="Générer son HTML sous Flask avec Jinja2"> <meta property="og:title" value="Générer son HTML sous Flask avec Jinja2"> <meta http-equiv="cleartype" content="on"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml"> <link rel="stylesheet" href="/css/screen.css?v=113"> <!--[if lt IE 9]><script src="/js/compiled/modernizr.min.js"></script><![endif]--> </head> <body> <header role="post"> <div class="container"> <h1 id="logo"> <a href="/" title="Phollow.me"> <img src="/images/phollow-logo3.png" alt="Phollow.me"> </a> </h1> </div> </header> <section role="articles"> <div class="container"> <article class="post"> <time datetime="2012-10-23 20:40:00 +0200">Oct 23, 2012</time> <h2 class="entry-title"> <a title="Générer son HTML sous Flask avec Jinja2" href="/2012/10/generer-html-flask-jinja2/">Générer son HTML sous Flask avec Jinja2</a> </h2> <p class="desc">Création de templates sous Python.</p> <section role="post-content"> <p>Suite du <a href="http://phollow.fr/2012/08/demarrer-la-creation-site-python-flask/">précédent article</a> sur le développement web avec Python &amp; Flask, nous allons voir comment afficher nos différentes pages. Assembler du HTML tend à être fait avec un moteur de templates. Il en existe plusieurs sous Python, mais nous allons nous intéresser uniquement à <strong>Jinja2</strong> étant donné qu’il est fourni de base avec Flask. <em>Bien sûr Flask ne vous force pas non plus à l’utiliser et rien ne vous empêche d’en prendre un autre.</em></p> <h3>Logique du code dans les templates</h3> <p>Si vous avez déjà utilisé des templates dans d’autres langages, vous savez qu’il faut limiter la complexité du code à l’intérieur de ceux-ci. Les templates proposent des opérateurs de base pour gérer des boucles ou des conditions, et des modules pour transformer l’affichage de certaines variables. Quand vous devez faire quelque chose de complexe, la bonne pratique est de lire déjà la documentation pour voir s’il n’existe pas déjà une fonction pour ça. Ensuite il est toujours possible d’augmenter les capacités de Jinja2 avec un module fait maison. Plus d’infos sur ça plus tard dans l’article.</p> <p>Toujours est-il que les templates doivent rester <strong>simple</strong>, de telle manière à ce qu’un designer puisse intégrer vos pages sans trop se poser de questions (no troll).</p> <h3>Usage bas niveau</h3> <div class="highlight"><pre><code class="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;umad {{ name }}?&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Jérôme&#39;</span><span class="p">)</span>
<span class="s">u&#39;umad Jérôme?&#39;</span>
</code></pre></div> <p>Voilà en gros le principe. Dans l'utilisation courante on utilisera pas ces méthodes, car on chargera plutôt un fichier .html. Mais c’est ce qui se passe, <em>à peu près</em>, en arrière-plan.</p> <h3>Exemple concret avec Flask</h3> <p>Il faut créer un dossier <code>templates/</code> à la racine du projet, c’est ici que Jinja2 ira chercher par défaut vos fichiers.</p> <div class="highlight"><pre><code class="html+jinja"><span class="c">{# projet/templates/layout.html: #}</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">&quot;fr&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">&quot;content&quot;</span><span class="nt">&gt;</span>
            <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
            <span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
        <span class="nt">&lt;/section&gt;</span>
        <span class="nt">&lt;footer</span> <span class="na">id=</span><span class="s">&quot;footer&quot;</span><span class="nt">&gt;</span>
            Copyright 2012 etc.
        <span class="nt">&lt;/footer&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div> <div class="highlight"><pre><code class="html+jinja"><span class="c">{# projet/templates/index.html: #}</span>
<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;layout.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Le titre de ma page<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
    <span class="nt">&lt;h1&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;ul&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">user</span> <span class="k">in</span> <span class="nv">users</span> <span class="cp">%}</span>
        <span class="nt">&lt;li&gt;</span><span class="cp">{{</span> <span class="nv">user</span> <span class="cp">}}</span><span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</code></pre></div> <p>Et maintenant côté Python:</p> <div class="highlight"><pre><code class="python"><span class="c"># projet/app.py:</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="s">u&quot;Jérôme&quot;</span><span class="p">,</span> <span class="s">u&quot;Rick Astley&quot;</span><span class="p">,</span> <span class="s">u&quot;Tony Stark&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">users</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>
</code></pre></div> <p>Commençons par la fin. On a une route qui pointe sur la racine du site, on crée une liste appelée <code>users</code> contenant le nom de 3 personnes. On demande ensuite à Flask de nous retourner le template index.html en lui passant le contexte (notre liste). Le template index <a href="http://jinja.pocoo.org/docs/templates/#template-inheritance">hérite</a> du template layout. L’objet users étant une liste, on peut utiliser une boucle <code>{% for %}{% endfor %}</code> pour itérer. La liste des opérateurs (boucles, conditions…) peut se trouver <a href="http://jinja.pocoo.org/docs/templates/#list-of-control-structures">ici</a>.</p> <p><strong>Note:</strong> Les variables sont par défaut échappées dans Flask. (XSS, tout ça).</p> <h3>Les filtres</h3> <p>Un filtre permet de transformer une variable en la passant dans une fonction. Par exemple couper un texte au bout de X caractères, désactiver l’échappement pour cette variable en particulier, etc.</p> <div class="highlight"><pre><code class="jinja"><span class="c">{# Par exemple mon_titre=&quot;mon super titre&quot; #}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">mon_titre</span><span class="o">|</span><span class="nf">title</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">  -&gt; &quot;Mon Super Titre&quot;</span>
</code></pre></div> <p>Liste des filtres disponibles de base dans Jinja2, <a href="http://jinja.pocoo.org/docs/templates/#builtin-filters">ici</a>.</p> <h3>Création d’un filtre custom pour Jinja2</h3> <p>C’est plutôt facile d’augmenter les capacités de Jinja2. Par exemple:</p> <div class="highlight"><pre><code class="python"><span class="nd">@app.template_filter</span><span class="p">(</span><span class="s">&#39;cut&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="s">&quot;foo&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Enlève certains caractères d’une chaîne de caractères&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</code></pre></div> <div class="highlight"><pre><code class="jinja"><span class="c">{# name=&quot;foobar&quot; dans cet exemple #}</span><span class="x"></span>
<span class="cp">{{</span> <span class="nv">name</span><span class="o">|</span><span class="nf">cut</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">  -&gt; &quot;bar&quot;</span>
<span class="cp">{{</span> <span class="nv">name</span><span class="o">|</span><span class="nf">cut</span><span class="o">(</span><span class="s2">&quot;f&quot;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">  -&gt; &quot;oobar&quot;</span>
</code></pre></div> <p>Plus d’infos sur <a href="http://jinja.pocoo.org/docs/api/#custom-filters">cette page</a> et <a href="http://flask.pocoo.org/docs/templating/#registering-filters">celle-ci</a>.</p> <h3>Documentation</h3> <p>Sur cette <a href="http://flask.pocoo.org/docs/templating/">page</a> on explique comment Jinja2 est intégré à Flask, avec les variables présentes par défaut et certains filtres ajoutés pour l’occasion. Et voici la <a href="http://jinja.pocoo.org/docs/">documentation officielle</a> du moteur de templates lui-même. Et avec ça, vous devriez pouvoir tout faire :)</p> </section> <section role="share"> <a href="https://twitter.com/share" class="twitter-share-button" data-via="phollow">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script> </section> <div id="disqus_thread"></div> <script>
          var disqus_shortname = 'phollowfr';
          var disqus_identifier = 'http://phollow.fr/2012/10/generer-html-flask-jinja2/';
          var disqus_url = 'http://phollow.fr/2012/10/generer-html-flask-jinja2/';

          (function() {
              var dsq = document.createElement('script');
              dsq.type = 'text/javascript'; 
              dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script> </article> </div> </section> <footer> <div class="container"> <p><a href="http://jrm.li" target="_blank">Jérôme Mahuet</a> - Hosted by <a href="http://heroku.com">Heroku</a> &amp; <a href="https://github.com/Rydgel/phollow">open-source</a>.</p> </div> </footer> </body> </html>