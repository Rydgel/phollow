<!doctype html>
<html class="no-js" lang="fr" dir="ltr" itemscope itemtype="http://schema.org/Article" xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://www.facebook.com/2008/fbml">
<head id="phollow-fr" data-template-set="html5-phollow-wordpress-theme" profile="http://purl.org/uF/hAtom/0.1/ http://purl.org/uF/2008/03/" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# phollow: http://ogp.me/ns/fb/phollow#">
  <meta charset="UTF-8">
  <title>Jekyll, Heroku et mon blog</title>
  <link href="https://plus.google.com/116513653525162928064" rel="publisher">
  <meta name="title" content="Jekyll, Heroku et mon blog">
  <meta name="author" content="Jérôme Mahuet">
  <meta name="Copyright" content="Copyright Jérôme Mahuet 2012. All Rights Reserved.">
  <meta name="google-site-verification" content="b3k5NRe5t9U-Pk1_CK_g5oN0U12YXuc55rUQWCHgbZY">
  <meta property="og:title" content="Jekyll, Heroku et mon blog">
  <meta property="og:type" content="phollow:post">
  <meta property="og:site_name" content="Phollow.me">
  <meta property="fb:admins" content="rydgel">
  <meta property="fb:app_id" content="101739241646">
  <meta itemprop="name" content="Jekyll, Heroku et mon blog">
  <meta http-equiv="cleartype" content="on">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="/atom.xml">
  <link rel="stylesheet" href="http://f.fontdeck.com/s/css/gZ5nfPju/xX9Gas/rZ9ymPUCM/4/phollow.fr/19429.css" type="text/css">
  <script src="/js/compiled/modernizr.min.js"></script>
  
  <link rel="stylesheet" href="/css/compiled/global.css?v=27">
</head>
<body>
  <div class="container" role="wrapper">
    <header role="banner" id="header-site" class="sixteen columns">
      <h1 id="logo" class="four columns alpha">
        <a href="/" title="Phollow.me">
          <img src="/images/phollow-logo.png" alt="Phollow.me">
        </a>
      </h1>
      <nav role="main-navigation" class="seven columns">
        <ul>
          <li>
            <a href="/" title="blog">
            <span class="ss-icon ss-write"></span>
            <span>Blog</span>
            </a>
          </li>
          <li>
            <a href="/archives" title="archives">
            <span class="ss-icon ss-database"></span>
            <span>#old</span>
            </a>
          </li>
          <li>
            <a href="http://jrm.li/projects" title="Projets">
            <span class="ss-icon ss-notebook"></span>
            <span>Projets</span>
            </a>
          </li>
          <li>
            <a href="http://jrm.li/" title="À propos">
            <span class="ss-icon ss-user"></span>
            <span>Me</span>
            </a>
          </li>
          <li>
            <a href="http://feeds2.feedburner.com/phollow/iuEO" title="RSS">
            <span class="ss-icon ss-rss"></span>
            <span>Rss</span>
            </a>
          </li>
        </ul>
      </nav>
      <hr style="border-bottom: 1px solid rgba(0, 0, 0, 0.02);">
    </header>

<div id="container" class="sixteen columns">
  <article class="post">
      <header>
    <h2 class="entry-title entry-single"><a href="/2012/05/jekyll-heroku-et-mon-blog">Jekyll, Heroku et mon blog</a></h2>
    
      <p class="desc">Comment héberger son site Jekyll gratuitement avec Heroku.</p>
    
      </header>
      <hr style="border-bottom: 1px solid rgba(0, 0, 0, 0.02);">
      <div class="entry single-page ten columns offset-by-three alpha">
        <div>
<figure>
<figcaption><img style="margin-top: 0;" src="http://static.phollow.fr/2012/05/heroku.jpeg" title="heroku" class="alignnone size-full">
</figcaption>
</figure>
</div>


<p>La migration du blog vers Jekyll était une première étape nécessaire pour une migration complète vers une solution gratuite – <em>ou presque</em>. Quand le site web n’est plus qu’une collection de fichiers statiques, l’hébergement devient vraiment simple.</p>

<h3>Heroku</h3>

<p>Heroku est une plate-forme <em>cloud</em> qui peut faire tourner des applications Python, Ruby, Scala etc. Le déploiement d’une app n’est pas plus compliqué qu’un <code>git push heroku master</code>. J’utilise la solution gratuite qui est amplement suffisante pour ce blog. Et si un jour ce blog devient extraordinairement populaire, je pourrai <em>scaler</em> simplement avec <code>ps:scale web=x</code>.</p>

<h3>Amazon S3</h3>

<p>J’en avais déjà parlé sur l’article précédent, les images et les uploads divers des articles sont tous stockés sur Amazon S3. C’était pour préparer la migration sur Heroku, car on est limité à 100Mo pour une application donné. Une application dont le code source fait 100Mo, c’est déjà énorme je trouve. Et généralement personne ne stocke les uploads d’une app. web dans un sous-dossier de l’application elle-même.</p>

<p>Du coup ça peut me permettre de stocker des trucs vraiment énormes sans avoir de limite (sauf les limites de mon porte-monnaie évidemment). D’un point de vue argent justement, S3 est la seule chose que je paie pour héberger ce blog, et pour info j’en suis à $0.03 depuis le début du mois.</p>

<h3>Sinatra</h3>

<p>Heroku ne permet pas de déployer juste un tas de fichiers statiques, par contre rien ne nous empêche de développer une application proxy, ici Sinatra, servant seulement à servir ces fichiers. Le code de l’application est simple&thinsp;:</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># encoding: utf-8</span>
<span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>

<span class="n">configure</span> <span class="k">do</span>
  <span class="n">set</span> <span class="ss">:public_folder</span><span class="p">,</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;_site&quot;</span><span class="p">)</span> <span class="p">}</span>
  <span class="c1"># Last modification time for browser cache</span>
  <span class="vi">@last_mod_time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
<span class="k">end</span>

<span class="n">before</span> <span class="k">do</span>
  <span class="n">headers</span> <span class="s2">&quot;X-UA-Compatible&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;IE=Edge,chrome=1&quot;</span>
  <span class="n">expires</span> <span class="mi">300</span><span class="p">,</span> <span class="ss">:public</span><span class="p">,</span> <span class="ss">:must_revalidate</span>
  <span class="n">last_modified</span><span class="p">(</span><span class="vi">@last_mod_time</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
  <span class="n">send_file</span><span class="p">(</span><span class="s1">&#39;_site/index.html&#39;</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">&#39;/*&#39;</span> <span class="k">do</span>
  <span class="n">file_path</span> <span class="o">=</span> <span class="s1">&#39;_site/&#39;</span> <span class="o">+</span> <span class="n">params</span><span class="o">[</span><span class="ss">:splat</span><span class="o">].</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/index.html&#39;</span>
  <span class="k">if</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">send_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">halt</span> <span class="mi">404</span>
<span class="k">end</span>

<span class="n">not_found</span> <span class="k">do</span>
  <span class="n">send_file</span><span class="p">(</span><span class="s1">&#39;_site/404.html&#39;</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>


<p>Le code de l’application a été mise à jour sur le <a href="https://github.com/Rydgel/phollow">dépôt Github du blog</a>.</p>

<h3>Autres solutions</h3>

<p>Heroku n’est pas la seule manière d’héberger votre blog à moindre coût. On peut utiliser entre autre :</p>

<ul>
<li>Les pages Github <a href="http://pages.github.com/">http://pages.github.com/</a></li>
<li>Mettre le site en entier dans Amazon S3</li>
<li>Dropbox</li>
</ul>


      </div>
      <cite class="omega three columns entry-meta">
        <p>
          <time datetime="2012-05-20 01:30:22 +0200" pubdate class="updated ss-clock">May 20, 2012</time>
          <br>
          <span class="ss-tag"><a href="/category/blog" rel="category tag">blog</a>, <a href="/category/web" rel="category tag">web</a></span>
          <br>
          
        </p>
        </cite>
      <footer class="share alpha twelve columns offset-by-three">
      <a id="tweet" href="http://twitter.com/?status=Jekyll,%20Heroku%20et%20mon%20blog%20http%3A%2F%2Fphollow.fr/2012/05/jekyll-heroku-et-mon-blog%20via%20%40phollow" class="ss-icon ss-social ss-twitter twitter-button">&nbsp;<span>Partager</span></a>
      </footer>
    </article>
      <hr>
      <div id="disqus_thread"></div>
      <script>
          var disqus_shortname = 'phollowfr';
          var disqus_identifier = 'http://phollow.fr/2012/05/jekyll-heroku-et-mon-blog/';
          var disqus_url = 'http://phollow.fr/2012/05/jekyll-heroku-et-mon-blog/';

          (function() {
              var dsq = document.createElement('script');
              dsq.type = 'text/javascript'; 
              dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
</div>


<footer id="footer" role="contentinfo" class="sixteen columns">
  <nav role="navigation">
    <ul>
      <li><a href="/">Homepage</a></li>
      <li><a href="http://twitter.com/phollow">Twitter</a></li>
      <li><a href="https://www.facebook.com/Phollow.fr">Facebook</a></li>
      <li><a href="http://dribbble.com/phollow">Dribbble</a></li>
      <li><a href="mailto:rydgel@phollow.fr">Contact</a></li>
    </ul>
  </nav>
  <span class="copyright">Copyright © 2012 <a rel="author"
      href="https://plus.google.com/113221045987282389062?rel=author"
      title="Jérôme Mahuet">+Jérôme Mahuet</a> All Rights Reserved.
    Hosted by <a href="http://www.heroku.com/">Heroku.</a></span>
<a title="Phollow.me" class="footer-logo-link" href="http://phollow.fr"><img src="/images/phollow-logo-footer.png" alt="Phollow.me"></a>
</footer>

</div><!-- container -->
<script src="/js/compiled/global.js?v=8"></script>

<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4ec64821f5a1f55c33000003');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
</body>
</html>

